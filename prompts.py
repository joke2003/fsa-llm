# prompts.py
# This file contains the detailed prompts for each analysis module.
# Version 1.9.5 - Adapted for Batch Information Needs Planner with pre-fetched info.
#                 LLM now uses pre-fetched search and document content.
#                 Corresponds to app version 0.9.30+
# Placeholders: [公司名称], [行业名称], [最新报告期标签], [所有报告期标签], 
#               [财务数据摘要] (inventory of available documents like footnotes, MD&A - for context only),
#               [核心三表数据_所有报告期] (full core BS, IS, CFS data for all periods as a JSON string),
#               [前期分析结论摘要], [模块名称], [分析角度],
#               [宏观经济分析结论], [行业分析结论],
#               [预获取的搜索查询结果], [预获取的文档提取内容]

# Standard instruction block for data usage to be included in relevant prompts
CORE_DATA_USAGE_INSTRUCTION = """
**重要数据与信息使用指令（当前分析角度：[分析角度]）：**

您在进行分析时，必须始终从“[分析角度]”的角度出发，侧重于该角度最关注的财务指标、风险和机遇。
* **股权投资角度**：更关注公司的盈利能力、成长性、现金流创造能力、竞争优势、管理层素质以及最终的股东回报（如ROE、股息、股价增值潜力）。
* **债权投资角度**：更关注公司的偿债能力（短期和长期）、现金流稳定性、资产质量、债务结构以及破产风险。
* **债股双投角度**：需要综合平衡风险与回报，既要关注偿债安全性，也要评估成长性和盈利潜力。

您将在下方看到由**文本标记为‘核心三表数据_所有报告期’**的部分，其中包含了所有已上传报告期的资产负债表、利润表和现金流量表的**完整数据，格式为一个JSON字符串**。
该JSON字符串是一个数组，每个数组元素代表一张具体的财务报表，其结构通常如下：
```json
{
  "report_period": "报告期标签 (例如：2023 Annual)",
  "statement_name": "报表名称 (例如：资产负债表 (Balance Sheet))",
  "columns": ["列标题1", "列标题2", ...], // 列标题列表
  "data": [ // 数据，为二维列表，每个子列表代表一行
    ["科目1", "数值1A", "数值1B", ...],
    ["科目2", "数值2A", "数值2B", ...],
    // ... 更多行 ...
  ],
  "notes": "可能的截断提示或其他说明" // 可选
}
```
在进行财务分析和计算时，您**必须**解析这个JSON字符串并直接使用其中提供的数据。

为了辅助您的分析，相关的外部搜索信息和文档细节已经**预先获取**，并将分别通过**文本标记为‘预获取的搜索查询结果’**和**文本标记为‘预获取的文档提取内容’**的占位符提供给您。您应主要依赖这些预先提供的信息进行分析。
由**文本标记为‘财务数据摘要’**提供的占位符信息列出了可用的补充文本文档（如财务报表附注、MD&A）的总体清单，这有助于您理解预获取信息的原始范围，但您**不再需要自行调用工具**来动态获取这些信息或进行外部搜索。

**严禁在缺乏明确数据支持（即未从由文本标记为‘核心三表数据_所有报告期’提供的JSON中有效解析并找到，或未从由文本标记为‘预获取的搜索查询结果’和‘预获取的文档提取内容’提供的占位符中找到）的情况下自行估算、记忆或杜撰任何财务数据或文本信息。所有分析和计算都必须基于可验证的数据来源。**
"""

# Standard instruction for confidence assessment and JSON output
CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION = """

**分析结论置信度评估与输出格式要求：**
在您完成上述所有分析后，请对您的分析结论进行一次自我评估，并给出一个置信度百分比（例如 "85%"，范围在50%至100%之间）。
在评估置信度时，请务必综合考虑以下因素（并结合当前的分析角度：[分析角度]）：
1.  **数据充分性与准确性：** 您在分析过程中所依赖的数据（包括由**文本标记为‘核心三表数据_所有报告期’**提供的JSON、由**文本标记为‘宏观经济分析结论’**提供的用户结论、由**文本标记为‘行业分析结论’**提供的系统结论、以及通过**文本标记为‘预获取的搜索查询结果’**和**文本标记为‘预获取的文档提取内容’**提供的补充信息）是否充分、清晰、准确且及时？是否存在数据缺失或质量问题？
2.  **分析方法与模型的适用性：** 您所使用的分析方法、模型或框架对于分析“[公司名称]”这家特定公司、其所处的“[行业名称]”行业以及当前的中国经济环境是否高度适用？这些方法是否存在固有假设或局限性？
3.  **分析过程中的不确定性与挑战：** 在分析过程中是否遇到了任何显著的限制、挑战、模糊地带或值得特别关注的问题（例如，复杂的关联交易难以穿透、会计政策选择的特殊性、预测的高度不确定性等）？
4.  **结论的明确性与支持度：** 您的分析结论是否能够基于可靠数据和逻辑清晰地得出，还是存在较多的主观判断或推测成分？

请将您的**完整分析内容**（使用Markdown格式，包含所有分析步骤、计算过程、必要的表格、趋势描述和最终结论，并始终体现[分析角度]的侧重点）和**置信度评估**，严格按照以下JSON格式返回。确保JSON结构正确无误：
```json
{
  "analysis_text": "您的完整分析内容（Markdown格式）...",
  "confidence_score": "您评估的置信度百分比，例如 '85%'"
}
```
"""

MODULE_PROMPTS = {
    # --- 第一部分：战略定位、治理与行业环境分析 ---
    "1.1 波特五力模型": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，最新报告期：[最新报告期标签]，分析角度：[分析角度]）进行波特五力模型分析。
分析时请综合考虑历史数据趋势，可参考的报告期包括：[所有报告期标签]。

{CORE_DATA_USAGE_INSTRUCTION}

以下是所有报告期的核心三表数据 (JSON格式)：
[核心三表数据_所有报告期]

以下是为本模块预获取的外部搜索信息：
```
[预获取的搜索查询结果]
```

以下是为本模块预获取的文档提取内容（来自财务报表附注或MD&A）：
```
[预获取的文档提取内容]
```

此外，请参考以下已有的分析结论：
**宏观经济分析结论：** ```
[宏观经济分析结论]
```

请按以下结构进行分析，并始终从[分析角度]出发调整侧重点，充分利用上方提供的核心三表数据JSON、预获取的搜索信息和文档内容：
1.  **供应商的议价能力：** 审阅财务报表数据（特别是成本结构、毛利率趋势）。结合预获取的关于主要供应商、采购集中度、供应商集中度、转换成本等信息。综合评估[公司名称]供应商的议价能力（强/中/弱），并说明判断依据。
2.  **购买者的议价能力：** 审阅财务报表数据（特别是收入结构、客户集中度、应收账款周转率趋势）。结合预获取的关于购买者集中度、产品差异化、客户转换成本等信息。综合评估[公司名称]购买者的议价能力（强/中/弱），并说明判断依据。
3.  **新进入者的威胁：** 从财务报表数据（如研发投入、品牌建设费用）中寻找竞争优势证据。结合预获取的关于行业进入壁垒、资本需求、技术壁垒等信息。综合评估新进入者对[公司名称]的威胁程度（高/中/低），并说明判断依据。
4.  **替代品的威胁：** 结合预获取的关于行业主要替代品、性价比、客户转向成本等信息。分析这些替代品对[公司名称]构成的威胁程度（高/中/低），并说明判断依据。
5.  **现有竞争者之间的竞争程度：** 从财务报表数据（如市场份额变化趋势、销售费用占比、利润率波动）中分析竞争态势。结合预获取的关于行业主要竞争对手、市场集中度、行业增长速度等信息。综合评估行业内现有竞争的激烈程度（激烈/一般/缓和），并说明判断依据。

请对每个“力”给出明确的评估，并提供支持您判断的关键信息和数据。最后，请对[公司名称]所处的整体行业竞争环境给出一个综合评价。**此综合评价将作为后续模块的“[行业分析结论]”的输入。**
参考前期分析结论：
[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}
        """
    },
    "1.2 SWOT 分析": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，最新报告期：[最新报告期标签]，分析角度：[分析角度]）进行SWOT分析。
分析时请综合考虑历史数据趋势，可参考的报告期包括：[所有报告期标签]。

{CORE_DATA_USAGE_INSTRUCTION}

以下是所有报告期的核心三表数据 (JSON格式)：
[核心三表数据_所有报告期]

以下是为本模块预获取的外部搜索信息（例如关于公司核心竞争力、行业政策、技术趋势、市场规模等）：
```
[预获取的搜索查询结果]
```

以下是为本模块预获取的文档提取内容（例如从MD&A中提取的经营管理信息）：
```
[预获取的文档提取内容]
```

此外，请参考以下已有的分析结论：
**宏观经济分析结论：** ```
[宏观经济分析结论]
```
**行业分析结论（来自波特五力模型）：** ```
[行业分析结论]
```

请基于以上提供的所有信息和分析角度，系统梳理公司的优势(S)、劣势(W)、机会(O)和威胁(T)，并始终从[分析角度]出发调整侧重点。
1.  **内部因素 (S & W):** 财务表现（基于核心三表数据JSON解析获取）、经营管理（参考预获取的文档内容）、资源与能力（参考预获取的搜索信息）。
2.  **外部因素 (O & T):** 宏观环境（参考[宏观经济分析结论]及预获取的搜索信息）、行业环境（参考[行业分析结论]及预获取的搜索信息）、市场动态。

请将分析结果以清晰的列表形式呈现，每个S/W/O/T点都应有简明扼要的描述和依据。
最后，简要探讨基于SWOT分析的可能战略方向。
参考前期分析结论：
[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}
        """
    },
    "1.4 公司治理与管理层素质评估": {
        "main_prompt_template": f"""
请对 [公司名称]（所属行业：[行业名称]，最新报告期：[最新报告期标签]，分析角度：[分析角度]）的公司治理结构和管理层素质进行评估。

{CORE_DATA_USAGE_INSTRUCTION}

以下是所有报告期的核心三表数据 (JSON格式，可能间接反映治理效果)：
[核心三表数据_所有报告期]

以下是为本模块预获取的外部搜索信息（例如关于股权结构变动、董事会成员背景、高管薪酬方案、信息披露违规记录、核心高管背景等）：
```
[预获取的搜索查询结果]
```

以下是为本模块预获取的文档提取内容（例如从年报治理报告、董监高简介中提取的信息）：
```
[预获取的文档提取内容]
```

此外，请参考以下已有的分析结论：
**宏观经济分析结论：** ```
[宏观经济分析结论]
```
**行业分析结论：** ```
[行业分析结论]
```

评估应至少覆盖以下方面，并结合预获取的信息和公开材料，始终从[分析角度]出发调整侧重点：
1.  **股权结构与股东权利。** 2.  **董事会运作与独立性。** 3.  **管理层激励与约束机制。** 4.  **信息披露质量与透明度。** 5.  **关联交易与内部控制。**
6.  **管理层素质与稳定性。** 请对每个方面进行评价，并最终给出一个关于[公司名称]公司治理整体水平和管理层素质的综合评估。
参考前期分析结论：
[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}
        """
    },
    "1.5 财务报表结构与趋势分析": {
        "main_prompt_template": f"""
请对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]）基于已上传的 [所有报告期标签] 财务报表数据，进行财务报表结构与趋势分析。

{CORE_DATA_USAGE_INSTRUCTION}

以下是所有报告期的核心三表数据 (JSON格式)，您必须基于这些数据进行分析：
[核心三表数据_所有报告期]

以下是为本模块预获取的文档提取内容（例如从附注和MD&A中提取的对结构变化的解释）：
```
[预获取的文档提取内容]
```

此外，请参考以下已有的分析结论：
**宏观经济分析结论：** ```
[宏观经济分析结论]
```
**行业分析结论：** ```
[行业分析结论]
```

分析应侧重于从战略高度理解公司的资源配置、经营特点和财务状况的演变，并始终从[分析角度]出发调整侧重点：
1.  **资产负债表结构与趋势分析。**
2.  **利润表结构与趋势分析。**
3.  **现金流量表结构与趋势分析。**

对每个主要结构或趋势变化，请提供可能的解释（可参考预获取的文档内容），并尝试将其与公司的战略、行业特点或宏观经济环境联系起来。
参考前期分析结论：
[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}
        """
    },
    "2.1 综合比率分析": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），基于已上传的 [所有报告期标签] 财务报表数据，进行全面的财务比率分析。

{CORE_DATA_USAGE_INSTRUCTION}

以下是所有报告期的核心三表数据 (JSON格式)，您必须基于这些数据进行所有比率的计算：
[核心三表数据_所有报告期]

以下是为本模块预获取的外部搜索信息（例如行业平均财务比率、[公司名称]主要竞争对手名单及其关键财务比率、[公司名称]历史股价和发行股数等）：
```
[预获取的搜索查询结果]
```

此外，请参考以下已有的分析结论：
**宏观经济分析结论：** ```
[宏观经济分析结论]
```
**行业分析结论：** ```
[行业分析结论]
```

分析应至少覆盖以下类别，并对每个比率进行计算、趋势分析、与行业平均水平或主要竞争对手的对比分析（利用预获取的搜索信息），并给出专业的解读，始终从[分析角度]出发调整侧重点：
1.  **短期偿债能力**; 2. **长期偿债能力**; 3. **营运效率**; 4. **盈利能力**; 5. **成长能力**; 6. **市场价值比率** (若为上市公司)。
请清晰列出各比率的计算公式、各期计算结果、趋势分析、对比分析及综合评价。
参考前期分析结论：
[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}
        """
    },
    "2.2 杜邦分析": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），基于已上传的 [所有报告期标签] 财务报表数据进行杜邦分析。
{CORE_DATA_USAGE_INSTRUCTION}
核心三表数据 (JSON格式)：[核心三表数据_所有报告期]
预获取的搜索信息（例如行业平均杜邦分析指标）：```[预获取的搜索查询结果]```
宏观经济分析结论：```[宏观经济分析结论]```
行业分析结论：```[行业分析结论]```
前期“综合比率分析”模块可能已计算出ROE、销售净利率、总资产周转率、权益乘数，请利用。否则，**必须**从核心三表数据JSON中重新计算。
分析应包括（体现[分析角度]）：1. 杜邦体系构建与计算。2. 各组成部分比率计算与趋势。3. ROE变动归因。4. 与行业/对手对比（利用预获取信息）。5. 综合评价。
参考前期分析结论：[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}"""
    },
    "2.3 分部信息分析": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），如果公司在其财务报告披露了分部信息，请基于已上传的 [所有报告期标签] 数据进行分部信息分析。
{CORE_DATA_USAGE_INSTRUCTION}
核心三表数据 (JSON格式)：[核心三表数据_所有报告期]
预获取的文档提取内容（例如从附注中提取的“分部报告”详细内容）：```[预获取的文档提取内容]```
宏观经济分析结论：```[宏观经济分析结论]```
行业分析结论：```[行业分析结论]```
若披露了分部信息（参考预获取的文档内容），请分析（体现[分析角度]）：识别报告分部；各分部经营业绩；主要分部与增长驱动力；分部间协同与风险分散；与公司整体战略的关联。如果未披露，请明确指出。
参考前期分析结论：[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}"""
    },
    "2.4 Piotroski F-Score 模型": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），基于 [所有报告期标签]（至少最近两年）的财务报表数据，计算并解读Piotroski F-Score。
{CORE_DATA_USAGE_INSTRUCTION}
核心三表数据 (JSON格式)：[核心三表数据_所有报告期]
宏观经济分析结论：```[宏观经济分析结论]```
行业分析结论：```[行业分析结论]```
Piotroski F-Score通过9个二元信号评估财务健康。请按步骤进行（所有计算**必须**基于核心三表数据JSON，**严禁杜撰**），并从[分析角度]解读结果：1. 数据准备与计算9项指标并评分。2. 计算总F-Score。3. 结果解读。
参考前期分析结论：[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}"""
    },
    "3.1 财务报表附注深度解读与关键会计政策评估": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），基于最新一期 [最新报告期标签] 的财务报表附注（及可参考的前期附注 [所有报告期标签]），进行深度解读与关键会计政策评估。
{CORE_DATA_USAGE_INSTRUCTION}
核心三表数据 (JSON格式)：[核心三表数据_所有报告期]
预获取的搜索信息（例如行业常用会计政策）：```[预获取的搜索查询结果]```
预获取的文档提取内容（例如从附注中提取的“重要会计政策和会计估计”、“关联方交易”、“或有事项”等详情）：```[预获取的文档提取内容]```
宏观经济分析结论：```[宏观经济分析结论]```
行业分析结论：```[行业分析结论]```
分析应至少关注（体现[分析角度]），并充分利用预获取的信息：1. 重要会计政策与会计估计梳理。2. 会计政策的行业比较与稳健性评估。3. 会计政策与估计变更分析。4. 或有事项与承诺事项解读。5. 关联方关系及交易分析。6. 其他重要附注信息。
最终对会计政策选择、会计信息质量及潜在风险给出一个综合评价。
参考前期分析结论：[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}"""
    },
    "3.2 Beneish M-Score": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），基于 [所有报告期标签]（至少最近两年）的财务报表数据，计算并解读Beneish M-Score，以评估盈余操纵的可能性。
{CORE_DATA_USAGE_INSTRUCTION}
核心三表数据 (JSON格式)：[核心三表数据_所有报告期]
预获取的搜索信息（例如关于Beneish M-Score模型的最新研究）：```[预获取的搜索查询结果]```
宏观经济分析结论：```[宏观经济分析结论]```
行业分析结论：```[行业分析结论]```
Beneish M-Score通过8个财务指标构建模型。请按步骤进行（所有计算**必须**基于核心三表数据JSON，**严禁杜撰**），并从[分析角度]解读结果：1. 数据准备与计算8个财务指标。2. 计算M-Score。3. 结果解读（参考预获取的搜索信息）。
参考前期分析结论：[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}"""
    },
    "3.3 Dechow F-Score (理念)": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），基于 [所有报告期标签] 财务报表数据、附注信息以及可能的外部信息，运用Dechow F-Score的理念，定性评估财务报表发生会计差错或存在盈余管理的“警示信号”。
{CORE_DATA_USAGE_INSTRUCTION}
核心三表数据 (JSON格式)：[核心三表数据_所有报告期]
预获取的搜索信息（例如公司历史盈利预测与达成情况、审计意见变更等）：```[预获取的搜索查询结果]```
预获取的文档提取内容（例如从附注中提取的会计政策、关联交易、内控等详情）：```[预获取的文档提取内容]```
宏观经济分析结论：```[宏观经济分析结论]```
行业分析结论：```[行业分析结论]```
Dechow F-Score从以下维度考察（体现[分析角度]），并利用预获取信息：应计质量；财务表现与市场压力；公司治理与内控缺陷；会计政策选择与变更的激进性；关联交易的复杂性与非公允性；外部监管与法律环境。
请针对各维度分析，识别“警示信号”，并对财务报告整体可靠性给予定性评估。
参考前期分析结论：[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}"""
    },
    "3.4 应计项目分析": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），基于 [所有报告期标签] 财务报表数据，进行应计项目分析，以评估盈利质量和盈余管理迹象。
{CORE_DATA_USAGE_INSTRUCTION}
核心三表数据 (JSON格式)：[核心三表数据_所有报告期]
预获取的搜索信息（例如行业平均应计项目水平、“应计异象”研究）：```[预获取的搜索查询结果]```
宏观经济分析结论：```[宏观经济分析结论]```
行业分析结论：```[行业分析结论]```
分析应至少包括（所有计算**必须**基于核心三表数据JSON，**严禁杜撰**），并体现[分析角度]：1. 计算总应计额。2. 应计项目规模分析（与行业平均或对手比较，参考预获取信息）。3. 可操纵性应计项目估计(概念性)。4. 应计项目与未来业绩关系（参考预获取信息）。
对公司应计项目水平、盈利质量及盈余管理迹象给出一个综合评价。
参考前期分析结论：[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}"""
    },
    "3.5 经营活动现金流量与净利润的比较分析": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），基于 [所有报告期标签] 财务报表数据，对经营活动现金流量净额(CFO)与净利润(NI)进行深入比较分析，以评估盈利质量。
{CORE_DATA_USAGE_INSTRUCTION}
核心三表数据 (JSON格式)：[核心三表数据_所有报告期]
预获取的搜索信息（例如行业平均CFO/NI比率）：```[预获取的搜索查询结果]```
预获取的文档提取内容（例如从附注中提取的“将净利润调节为经营活动现金流量”的详细项目）：```[预获取的文档提取内容]```
宏观经济分析结论：```[宏观经济分析结论]```
行业分析结论：```[行业分析结论]```
分析应至少包括（所有计算**必须**基于核心三表数据JSON，**严禁杜撰**），并体现[分析角度]：1. CFO与NI规模与趋势对比。2. CFO/NI比率解读（与行业平均比较，参考预获取信息）。3. CFO与NI差异的主要构成项目分析（参考预获取的文档内容）。4. 盈利质量综合评估。
参考前期分析结论：[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}"""
    },
    "4.1 Altman Z-Score": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），基于 [所有报告期标签]（至少最近一期完整年度）的财务报表数据及必要的市场数据，计算并解读Altman Z-Score，评估财务困境和短期破产风险。
{CORE_DATA_USAGE_INSTRUCTION}
核心三表数据 (JSON格式)：[核心三表数据_所有报告期]
预获取的搜索信息（例如公司市值、Altman Z-Score在行业的适用性）：```[预获取的搜索查询结果]```
宏观经济分析结论：```[宏观经济分析结论]```
行业分析结论：```[行业分析结论]```
Altman Z-Score模型（上市公司）：Z = 1.2*X1 + 1.4*X2 + 3.3*X3 + 0.6*X4 + 1.0*X5。各变量定义（所有计算**必须**基于核心三表数据JSON及预获取的市值，**严禁杜撰**）：X1=(流动资产-流动负债)/总资产; X2=留存收益/总资产; X3=EBIT/总资产; X4=股东权益市值/总负债; X5=销售收入/总资产。
请按步骤计算并解读Z-Score，分析趋势和各变量贡献。参考预获取的适用性信息。
参考前期分析结论：[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}"""
    },
    "4.2 Ohlson O-Score (如适用)": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），若适用且数据可得，基于 [所有报告期标签]（至少最近一期完整年度）的财务报表数据，计算并解读Ohlson O-Score，预测未来1-2年破产概率。
{CORE_DATA_USAGE_INSTRUCTION}
核心三表数据 (JSON格式)：[核心三表数据_所有报告期]
预获取的搜索信息（例如Ohlson O-Score模型解释与应用）：```[预获取的搜索查询结果]```
宏观经济分析结论：```[宏观经济分析结论]```
行业分析结论：```[行业分析结论]```
Ohlson O-Score模型常见形式：O-Score = -1.32 - 0.407*SIZE + 6.03*TLTA - 1.43*WCTA + 0.076*CLCA - 1.72*OENEG - 2.37*NITA + 0.285*FUTL - 1.83*INTWO。各变量定义（所有计算**必须**基于核心三表数据JSON，**严禁杜撰**）。
请按步骤计算并解读O-Score和破产概率P，分析各变量贡献。参考预获取的解释信息。
参考前期分析结论：[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}"""
    },
    "4.3 利息保障倍数及现金流偿债能力分析": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），基于 [所有报告期标签] 财务报表数据，分析其利息保障倍数和现金流偿债能力。
{CORE_DATA_USAGE_INSTRUCTION}
核心三表数据 (JSON格式)：[核心三表数据_所有报告期]
预获取的搜索信息（例如公司最新信用评级）：```[预获取的搜索查询结果]```
预获取的文档提取内容（例如从附注中提取的“债务结构”详情）：```[预获取的文档提取内容]```
宏观经济分析结论：```[宏观经济分析结论]```
行业分析结论：```[行业分析结论]```
分析应至少包括（所有计算**必须**基于核心三表数据JSON，**严禁杜撰**），并体现[分析角度]（债权人角度更关注安全性）：1. 利息保障倍数（EBIT/CFO基础）。2. 现金流偿债能力分析（CFO/流动负债；CFO/总负债）。3. 债务结构与到期压力（参考预获取的文档内容和搜索信息）。4. 综合评价。
参考前期分析结论：[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}"""
    },
    "4.4 营运资金充足性与流动性分析": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），基于 [所有报告期标签] 财务报表数据，分析其营运资金充足性和流动性。
{CORE_DATA_USAGE_INSTRUCTION}
核心三表数据 (JSON格式)：[核心三表数据_所有报告期]
预获取的搜索信息（例如行业流动性基准）：```[预获取的搜索查询结果]```
预获取的文档提取内容（例如从附注中提取的“应收账款账龄”、“存货构成”、“银行授信”详情）：```[预获取的文档提取内容]```
宏观经济分析结论：```[宏观经济分析结论]```
行业分析结论：```[行业分析结论]```
分析应至少包括（所有计算**必须**基于核心三表数据JSON，**严禁杜撰**），并体现[分析角度]：1. 营运资本分析。2. 核心流动性比率分析（与行业基准比较，参考预获取信息）。3. 流动资产质量分析（结合预获取的文档内容）。4. 现金转换周期分析。5. 短期融资能力与依赖性（结合预获取的文档内容）。6. 综合评价。
参考前期分析结论：[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}"""
    },
    "5.1 可持续增长率模型 (SGR)": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），基于 [所有报告期标签] 财务报表数据，计算并分析其可持续增长率 (SGR)。SGR = ROE × 利润留存率.
{CORE_DATA_USAGE_INSTRUCTION}
核心三表数据 (JSON格式)：[核心三表数据_所有报告期]
预获取的搜索信息（例如行业平均SGR）：```[预获取的搜索查询结果]```
预获取的文档提取内容（例如从附注中提取的“股利分配政策”详情）：```[预获取的文档提取内容]```
宏观经济分析结论：```[宏观经济分析结论]```
行业分析结论：```[行业分析结论]```
若前期“综合比率分析”结果可用且含ROE和利润留存率，请利用。否则，**必须**从核心三表数据JSON中重新计算。
请按步骤进行（体现[分析角度]，股权投资者更关注SGR与实际增长匹配及驱动）：1. 数据准备与计算SGR。2. 结果分析与解读（参考预获取的行业信息）。
参考前期分析结论：[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}"""
    },
    "5.2 内部增长率模型 (IGR)": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），基于 [所有报告期标签] 财务报表数据，计算并分析其内部增长率 (IGR)。IGR = (ROA × 利润留存率) / (1 - ROA × 利润留存率).
{CORE_DATA_USAGE_INSTRUCTION}
核心三表数据 (JSON格式)：[核心三表数据_所有报告期]
宏观经济分析结论：```[宏观经济分析结论]```
行业分析结论：```[行业分析结论]```
若前期“综合比率分析”结果可用且含ROA和利润留存率，请利用。否则，**必须**从核心三表数据JSON中重新计算。
请按步骤进行（体现[分析角度]）：1. 数据准备与计算IGR。2. 结果分析与解读。
参考前期分析结论：[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}"""
    },
    "5.3 再投资率 (RR) 与投入资本回报率 (ROIC) 分析": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），基于 [所有报告期标签] 财务报表数据，分析其再投资率 (RR) 与投入资本回报率 (ROIC)，并评估其增长质量。
{CORE_DATA_USAGE_INSTRUCTION}
核心三表数据 (JSON格式)：[核心三表数据_所有报告期]
预获取的搜索信息（例如公司WACC估算）：```[预获取的搜索查询结果]```
宏观经济分析结论：```[宏观经济分析结论]```
行业分析结论：```[行业分析结论]```
分析应至少包括（所有计算**必须**基于核心三表数据JSON，**严禁杜撰**），并体现[分析角度]（股权投资者更关注ROIC与WACC比较及增长质量）：1. 计算ROIC。2. 计算RR。3. ROIC 与 WACC 的比较（参考预获取信息）。4. 增长质量评估。
参考前期分析结论：[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}"""
    },
    "5.4 盈利与现金流增长匹配度分析": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），基于 [所有报告期标签] 财务报表数据，分析其盈利增长与现金流增长的匹配程度。
{CORE_DATA_USAGE_INSTRUCTION}
核心三表数据 (JSON格式)：[核心三表数据_所有报告期]
宏观经济分析结论：```[宏观经济分析结论]```
行业分析结论：```[行业分析结论]```
分析应至少包括（所有计算**必须**基于核心三表数据JSON，**严禁杜撰**），并体现[分析角度]：1. 核心盈利指标与核心现金流指标的增长率计算与趋势比较。2. 匹配度解读。3. 结合前期盈利质量分析模块的结论。4. 综合评价。
参考前期分析结论：[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}"""
    },
    "6.1 销售预测方法探讨": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），探讨未来3-5年销售收入的合理预测方法，并给出预测的关键假设和初步预测思路。
{CORE_DATA_USAGE_INSTRUCTION}
核心三表数据 (JSON格式，主要为历史销售数据）：[核心三表数据_所有报告期]
预获取的搜索信息（例如行业市场规模预测报告）：```[预获取的搜索查询结果]```
预获取的文档提取内容（例如从MD&A中提取的公司战略、市场展望描述）：```[预获取的文档提取内容]```
宏观经济分析结论：```[宏观经济分析结论]```
行业分析结论：```[行业分析结论]```
探讨应包括（体现[分析角度]的预测侧重点和敏感性），并利用预获取信息：历史销售回顾；主要驱动因素分析；合适的预测模型选择；关键预测假设；初步预测思路。
参考前期分析结论：[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}"""
    },
    "6.2 成本与费用结构预测探讨": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），在已有未来3-5年销售收入预测的基础上，探讨如何预测其主要的成本与费用结构。
{CORE_DATA_USAGE_INSTRUCTION}
核心三表数据 (JSON格式，主要为历史成本费用数据）：[核心三表数据_所有报告期]
预获取的搜索信息（例如原材料价格预测、利率走势）：```[预获取的搜索查询结果]```
宏观经济分析结论：```[宏观经济分析结论]```
行业分析结论：```[行业分析结论]```
探讨应包括（体现[分析角度]的预测侧重点），并利用预获取信息：销售成本（历史毛利率）；营业费用；财务费用（结合负债和利率预测）；其他及税费。
参考前期分析结论：[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}"""
    },
    "6.3 资产负债表项目预测探讨": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），在已有未来3-5年利润表预测的基础上，探讨如何预测其资产负债表的主要项目。
{CORE_DATA_USAGE_INSTRUCTION}
核心三表数据 (JSON格式，主要为历史资产负债表项目）：[核心三表数据_所有报告期]
预获取的搜索信息（例如公司资本支出计划）：```[预获取的搜索查询结果]```
宏观经济分析结论：```[宏观经济分析结论]```
行业分析结论：```[行业分析结论]```
探讨应包括（体现[分析角度]的预测侧重点），并利用预获取信息：营运资本项目；非流动资产（CapEx预测）；负债与权益。
参考前期分析结论：[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}"""
    },
    "6.4 三表联动模型构建提示": { 
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），在已分别探讨了未来3-5年利润表和资产负债表主要项目预测方法的基础上，提供构建三表联动财务预测模型的关键步骤和勾稽关系提示。
{CORE_DATA_USAGE_INSTRUCTION} 
核心三表数据 (JSON格式，用于理解历史勾稽关系）：[核心三表数据_所有报告期]
宏观经济分析结论：```[宏观经济分析结论]```
行业分析结论：```[行业分析结论]```
请提示关键联动关系和构建步骤。
参考前期分析结论：[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}"""
    },
    "6.5 情景分析与敏感性测试提示": { 
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），在已构建完成未来3-5年三表联动财务预测模型的基础上，提示如何进行情景分析与敏感性测试。
{CORE_DATA_USAGE_INSTRUCTION} 
核心三表数据 (JSON格式，用于理解历史波动和设定情景参数）：[核心三表数据_所有报告期]
宏观经济分析结论：```[宏观经济分析结论]```
行业分析结论：```[行业分析结论]```
请提供情景分析和敏感性测试的操作步骤、核心变量和结果解读要点，并说明[分析角度]如何影响这些测试的侧重点。
参考前期分析结论：[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}"""
    },
    "7.1 公司自由现金流模型 (FCFF)": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），基于已完成的未来财务预测，运用公司自由现金流 (FCFF) 折现模型进行估值。
{CORE_DATA_USAGE_INSTRUCTION}
核心三表数据 (JSON格式，用于计算历史NOPAT、净投资、WACC参数等）：[核心三表数据_所有报告期]
预获取的搜索信息（例如Rf, Beta, ERP, Kd, 公司信用评级以估算WACC）：```[预获取的搜索查询结果]```
宏观经济分析结论：```[宏观经济分析结论]```
行业分析结论：```[行业分析结论]```
财务预测结果（NOPAT、资本性支出、折旧摊销、营运资本变动等）：[前期分析结论摘要] (重点是第六部分的预测输出)
FCFF估值步骤（体现[分析角度]，所有计算**必须**基于准确预测数据或历史数据JSON，**严禁杜撰**）：1. 计算预测期FCFF。2. 估算WACC (参考预获取信息)。3. 计算预测期FCFF现值。4. 估算终值 (TV)。5. 计算EV与股权价值。6. 计算每股价值并敏感性分析。
参考前期分析结论：[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}"""
    },
    "7.2 股权自由现金流模型 (FCFE)": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），基于已完成的未来财务预测，运用股权自由现金流 (FCFE) 折现模型进行估值。
{CORE_DATA_USAGE_INSTRUCTION}
核心三表数据 (JSON格式，用于计算历史FCFE或参数）：[核心三表数据_所有报告期]
宏观经济分析结论：```[宏观经济分析结论]```
行业分析结论：```[行业分析结论]```
财务预测结果：[前期分析结论摘要] (重点是第六部分的预测输出)
FCFE估值步骤（体现[分析角度]，所有计算**必须**基于准确预测数据或历史数据JSON，**严禁杜撰**）：1. 计算预测期FCFE。2. 估算股权成本 (Ke)。3. 计算预测期FCFE现值。4. 估算终值 (TV) of FCFE。5. 计算股权价值。6. 计算每股价值并敏感性分析。
参考前期分析结论：[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}"""
    },
     "7.3 股利贴现模型 (DDM)": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），如果该公司有稳定且可预测的股利支付历史和政策，运用股利贴现模型 (DDM) 进行估值。
{CORE_DATA_USAGE_INSTRUCTION}
核心三表数据 (JSON格式，用于获取历史股利、净利润等）：[核心三表数据_所有报告期]
预获取的搜索信息（例如公司股利政策公告）：```[预获取的搜索查询结果]```
预获取的文档提取内容（例如从附注中提取的股利政策描述）：```[预获取的文档提取内容]```
宏观经济分析结论：```[宏观经济分析结论]```
行业分析结论：```[行业分析结论]```
财务预测结果：[前期分析结论摘要]
DDM估值步骤（体现[分析角度]，所有计算**必须**基于准确预测数据或历史数据JSON，**严禁杜撰**）：1. 分析历史股利政策与支付情况（参考预获取信息）。2. 预测未来股利 (DPS)。3. 估算股权成本 (Ke)。4. 计算预测期股利现值。5. 估算终值 (TV) of Dividends。6. 计算每股价值与敏感性分析。
参考前期分析结论：[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}"""
    },
    "7.4 剩余收益模型 (RIM)": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），基于已完成的未来财务预测，运用剩余收益模型 (RIM) 进行估值。
{CORE_DATA_USAGE_INSTRUCTION}
核心三表数据 (JSON格式，用于获取历史净利润和股东权益）：[核心三表数据_所有报告期]
宏观经济分析结论：```[宏观经济分析结论]```
行业分析结论：```[行业分析结论]```
财务预测结果：[前期分析结论摘要] (重点是第六部分的预测输出)
RIM估值步骤（体现[分析角度]，所有计算**必须**基于准确预测数据或历史数据JSON，**严禁杜撰**）：1. 计算预测期剩余收益 (RI): RI(t) = 净利润(t) - (Ke × 期初股东权益账面价值(t))。2. 估算股权成本 (Ke)。3. 计算预测期RI现值。4. 估算终值 (TV) of RI。5. 计算股权价值: 股权价值 = 当前BV0 + Σ(预测期RI现值) + 终值RI部分的现值。6. 计算每股价值并敏感性分析。
参考前期分析结论：[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}"""
    },
    "7.5 可比公司分析/市场乘数法": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），运用可比公司分析法（市场乘数法）进行相对估值。
{CORE_DATA_USAGE_INSTRUCTION}
核心三表数据 (JSON格式，用于获取目标公司的历史财务指标）：[核心三表数据_所有报告期]
预获取的搜索信息（例如可比公司名单、其财务数据与市场数据如EPS, SPS, BVPS, EBITDA, 股价, 市值等）：```[预获取的搜索查询结果]```
宏观经济分析结论：```[宏观经济分析结论]```
行业分析结论：```[行业分析结论]```
前期分析结论：[前期分析结论摘要]
可比公司分析步骤（体现[分析角度]），并利用预获取信息：1. 理解目标公司。2. 筛选可比公司。3. 收集可比公司财务数据与市场数据。4. 计算市场乘数。5. 分析可比公司乘数并确定合理范围。6. 应用乘数进行估值（**必须**从核心三表数据JSON中获取目标公司准确指标）。7. 定性调整与结论。
参考前期分析结论：[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}"""
    },
    "7.6 基于账面价值的估值": {
        "main_prompt_template": f"""
请针对 [公司名称]（所属行业：[行业名称]，分析角度：[分析角度]），运用基于账面价值的方法进行估值分析。
{CORE_DATA_USAGE_INSTRUCTION}
核心三表数据 (JSON格式，用于获取最新一期股东权益等）：[核心三表数据_所有报告期]
预获取的搜索信息（例如公司股价、行业平均P/B或可比公司P/B）：```[预获取的搜索查询结果]```
预获取的文档提取内容（例如从附注中提取的资产质量、或有负债描述）：```[预获取的文档提取内容]```
宏观经济分析结论：```[宏观经济分析结论]```
行业分析结论：```[行业分析结论]```
前期分析结论：[前期分析结论摘要]
基于账面价值的估值分析包括（体现[分析角度]），并利用预获取信息：1. 计算每股净资产 (BVPS) (**必须**从核心三表数据JSON中获取)。2. 分析市净率 (P/B)。3. 调整账面价值 (概念性讨论)。4. 清算价值法 (概念性讨论)。5. 估值结论与适用性。
参考前期分析结论：[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}"""
    },
    "DEFAULT_PROMPT": { 
        "main_prompt_template": f"""
请对公司 '[公司名称]' (行业: [行业名称], 分析角度: [分析角度]) 进行关于 '[模块名称]' 的分析。

{CORE_DATA_USAGE_INSTRUCTION}

以下是所有报告期的核心三表数据 (JSON格式)，请基于这些数据进行分析：
[核心三表数据_所有报告期]

以下是预获取的与本模块分析相关的外部搜索信息：
```
[预获取的搜索查询结果]
```

以下是预获取的与本模块分析相关的文档提取内容：
```
[预获取的文档提取内容]
```

此外，请参考以下已有的分析结论：
**宏观经济分析结论：** ```
[宏观经济分析结论]
```
**行业分析结论：** ```
[行业分析结论]
```

如果适用，请进行趋势分析，并在详细解释时主要基于最新一期数据。
**所有分析和计算都必须基于所提供的准确财务数据和预获取信息，严禁杜撰或基于不完整信息估算。**
参考前期分析结论：
[前期分析结论摘要]
{CONFIDENCE_ASSESSMENT_JSON_OUTPUT_INSTRUCTION}
        """
    }
}
